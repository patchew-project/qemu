#
# Docker LoongArch64 cross-compiler target
#
# This docker target is used for building loongarch64 tests. As it also
# needs to be able to build QEMU itself in CI we include it's
# build-deps. It is also a "stand-alone" image so as not to be
# triggered by re-builds on other base images given it takes a long
# time to build.
#

FROM docker.io/gentoo/stage3:20211229

ADD build-toolchain.sh /root/build-toolchain.sh
RUN cd /root && ./build-toolchain.sh

# Specify the cross prefix for this image (see tests/docker/common.rc)
# Also gcc 12 currently produces spurious warnings under our condition so
# disable Werror as well
ENV QEMU_CONFIGURE_OPTS --cross-prefix=loongarch64-unknown-linux-gnu- --disable-werror
# We don't have target support at the moment, so just verify that things build
ENV DEF_TARGET_LIST x86_64-softmmu,x86_64-linux-user
