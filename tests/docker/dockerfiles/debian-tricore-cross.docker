#
# Docker TriCore cross-compiler target
#
# This docker target builds on the debian Stretch base image.
#
# Copyright (c) 2018 Philippe Mathieu-Daudé
#
# SPDX-License-Identifier: GPL-2.0-or-later
#
FROM debian:9-slim

MAINTAINER Philippe Mathieu-Daudé <f4bug@amsat.org>

# Install common build utilities
RUN apt-get update && \
    DEBIAN_FRONTEND=noninteractive apt-get install -yy eatmydata && \
    DEBIAN_FRONTEND=noninteractive eatmydata \
    apt-get install -y --no-install-recommends \
        automake \
        bison \
        build-essential \
        ca-certificates \
        flex \
        git \
        libtool && \
    ln -s /usr/bin/cc /usr/bin/clang && \
    ln -s /usr/bin/gcc /usr/bin/tricore-gcc

RUN git clone --single-branch \
        https://github.com/bkoppelmann/tricore-binutils.git \
        /usr/src/binutils && \
    cd /usr/src/binutils && \
    cp /usr/share/libtool/build-aux/missing . && \
    chmod +x ylwrap binutils/ylwrap && \
    CFLAGS=-w ./configure --prefix=/usr --disable-nls --target=tricore && \
    make all install && \
    rm -rf /usr/src/binutils

# Specify the cross prefix for this image (see tests/docker/common.rc)
ENV QEMU_CONFIGURE_OPTS --cross-prefix=tricore-
