---
- name: Installation of extra packages to build QEMU
  hosts: all
  tasks:
    - name: Extra check for CentOS Stream 9
      lineinfile:
        path: /etc/redhat-release
        line: CentOS Stream release 9
        state: present
      check_mode: yes
      register: centos_stream_9

    - name: Enable EPEL repo on CentOS Stream 9
      dnf:
        name:
          - epel-release
        state: present
      when:
        - centos_stream_9

    - name: Enable CRB repo on CentOS Stream 9
      ini_file:
        path: /etc/yum.repos.d/centos.repo
        section: crb
        option: enabled
        value: "1"
      when:
        - centos_stream_9

    - name: Install basic packages to build QEMU on CentOS Stream 9
      dnf:
        name:
          - bzip2
          - bzip2-devel
          - capstone-devel
          - dbus-daemon
          - device-mapper-multipath-devel
          - diffutils
          - gcc
          - gcc-c++
          - genisoimage
          - gettext
          - git
          - glib2-devel
          - gnutls-devel
          - libaio-devel
          - libcap-ng-devel
          - libcurl-devel
          - libepoxy-devel
          - libfdt-devel
          - libgcrypt-devel
          - libiscsi-devel
          - libpmem-devel
          - librados-devel
          - librbd-devel
          - libseccomp-devel
          - libslirp-devel
          - libssh-devel
          - libxkbcommon-devel
          - lzo-devel
          - make
          - mesa-libEGL-devel
          - meson
          - nettle-devel
          - ninja-build
          - nmap-ncat
          - numactl-devel
          - pixman-devel
          - python3
          - python3-pip
          - python3-sphinx
          - python3-sphinx_rtd_theme
          - python3-tomli
          - rdma-core-devel
          - redhat-rpm-config
          - snappy-devel
          - systemd-devel
          - systemtap-sdt-devel
          - tar
          - zlib-devel
        state: present
      when:
        - centos_stream_9
