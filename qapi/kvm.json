# -*- Mode: Python -*-
# vim: filetype=python

##
# = KVM based feature API
##

##
# @KVMPMUFilterAction:
#
# Actions that KVM PMU filter supports.
#
# @deny: disable the PMU event/counter in KVM PMU filter.
#
# @allow: enable the PMU event/counter in KVM PMU filter.
#
# Since 10.0
##
{ 'enum': 'KVMPMUFilterAction',
  'prefix': 'KVM_PMU_FILTER_ACTION',
  'data': ['allow', 'deny'] }

##
# @KVMPMUEventEncodeFmt:
#
# Encoding formats of PMU event that QEMU/KVM supports.
#
# @raw: the encoded event code that KVM can directly consume.
#
# @x86-default: standard x86 encoding format with select and umask.
#
# Since 10.0
##
{ 'enum': 'KVMPMUEventEncodeFmt',
  'prefix': 'KVM_PMU_EVENT_FMT',
  'data': ['raw', 'x86-default'] }

##
# @KVMPMURawEvent:
#
# Raw PMU event code.
#
# @code: the raw value that has been encoded, and QEMU could deliver
#     to KVM directly.
#
# Since 10.0
##
{ 'struct': 'KVMPMURawEvent',
  'data': { 'code': 'uint64' } }

##
# @KVMPMUX86DefalutEvent:
#
# x86 PMU event encoding with select and umask.
# raw_event = ((select & 0xf00UL) << 24) | \
#              (select) & 0xff) | \
#              ((umask) & 0xff) << 8)
#
# @select: x86 PMU event select field, which is a 12-bit unsigned
#     number.
#
# @umask: x86 PMU event umask field.
#
# Since 10.0
##
{ 'struct': 'KVMPMUX86DefalutEvent',
  'data': { 'select': 'uint16',
            'umask': 'uint8' } }

##
# @KVMPMUFilterEvent:
#
# PMU event filtered by KVM.
#
# @format: PMU event format.
#
# Since 10.0
##
{ 'union': 'KVMPMUFilterEvent',
  'base': { 'format': 'KVMPMUEventEncodeFmt' },
  'discriminator': 'format',
  'data': { 'raw': 'KVMPMURawEvent',
            'x86-default': 'KVMPMUX86DefalutEvent' } }

##
# @KVMPMUFilterProperty:
#
# Property of KVM PMU Filter.
#
# @events: the KVMPMUFilterEvent list.
#
# Since 10.0
##
{ 'struct': 'KVMPMUFilterProperty',
  'data': { '*events': ['KVMPMUFilterEvent'] } }

##
# @KVMPMURawEventVariant:
#
# The variant of KVMPMURawEvent with the string, rather than the
# numeric value.
#
# @code: the raw value that has been encoded, and QEMU could deliver
#     to KVM directly.  This field is a uint64 string.
#
# Since 10.0
##
{ 'struct': 'KVMPMURawEventVariant',
  'data': { 'code': 'str' } }

##
# @KVMPMUX86DefalutEventVariant:
#
# The variant of KVMPMUX86DefalutEvent with the string, rather than
# the numeric value.
#
# @select: x86 PMU event select field.  This field is a 12-bit
#     unsigned number string.
#
# @umask: x86 PMU event umask field. This field is a uint8 string.
#
# Since 10.0
##
{ 'struct': 'KVMPMUX86DefalutEventVariant',
  'data': { 'select': 'str',
            'umask': 'str' } }

##
# @KVMPMUFilterEventVariant:
#
# The variant of KVMPMUFilterEvent.
#
# @format: PMU event format.
#
# Since 10.0
##
{ 'union': 'KVMPMUFilterEventVariant',
  'base': { 'format': 'KVMPMUEventEncodeFmt' },
  'discriminator': 'format',
  'data': { 'raw': 'KVMPMURawEventVariant',
            'x86-default': 'KVMPMUX86DefalutEventVariant' } }

##
# @KVMPMUFilterPropertyVariant:
#
# The variant of KVMPMUFilterProperty.
#
# @action: action that KVM PMU filter will take.
#
# @events: the KVMPMUFilterEventVariant list.
#
# Since 10.0
##
{ 'struct': 'KVMPMUFilterPropertyVariant',
  'data': { 'action': 'KVMPMUFilterAction',
            '*events': ['KVMPMUFilterEventVariant'] } }
